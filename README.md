# Tonkeeper InstantPay - Implementation & Testing Environment

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç **Tonkeeper InstantPay Browser Interaction Protocol** —Å–æ–≥–ª–∞—Å–Ω–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤ `SPECIFICATION.md`. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–∞–∫ –∫–æ—à–µ–ª–µ–∫, —Ç–∞–∫ –∏ dApp —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
npm install
```

### –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∏ mock wallet –∏ dApp –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
npm run dev

# –ò–ª–∏ –∑–∞–ø—É—Å–∫–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ:
npm run dev:mock-wallet  # Mock –∫–æ—à–µ–ª–µ–∫ –Ω–∞ http://localhost:3001
npm run dev:dapp         # dApp –Ω–∞ http://localhost:3000
```

### –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
```bash
npm run build
```

## üìÅ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
instant-pay/
‚îú‚îÄ‚îÄ packages/
‚îÇ   ‚îú‚îÄ‚îÄ types/              # –û–±—â–∏–µ TypeScript —Ç–∏–ø—ã –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
‚îÇ   ‚îú‚îÄ‚îÄ mock-wallet/        # Mock –∫–æ—à–µ–ª–µ–∫-—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
‚îÇ   ‚îî‚îÄ‚îÄ dapp/              # –¢–µ—Å—Ç–æ–≤–æ–µ dApp –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ SPECIFICATION.md        # –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–æ—Ç–æ–∫–æ–ª–∞  
‚îî‚îÄ‚îÄ README.md
```

## üß© –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. Types Package (`packages/types/`)
- –û–±—â–∏–µ TypeScript –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏–∑ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –ö–ª–∞—Å—Å—ã –æ—à–∏–±–æ–∫ (`InstantPayInvalidParamsError`, `InstantPayLimitExceededError`, `InstantPayConcurrentOperationError`)
- –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –ø—Ä–æ—Ç–æ–∫–æ–ª–∞

### 2. Mock Wallet (`packages/mock-wallet/`)
- –ò–Ω–∂–µ–∫—Ç–∏—Ä—É–µ—Ç `window.tonkeeper.instantPay` API
- –†–µ–∞–ª–∏–∑—É–µ—Ç –≤—Å–µ –º–µ—Ç–æ–¥—ã –ø—Ä–æ—Ç–æ–∫–æ–ª–∞
- –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∫–Ω–æ–ø–∫—É –æ–ø–ª–∞—Ç—ã –ø–æ–≤–µ—Ä—Ö —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- –°–∏–º—É–ª–∏—Ä—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- –ò–º–µ–µ—Ç –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –æ—Ç–ª–∞–¥–∫–∏

### 3. dApp (`packages/dapp/`)
- –¢–µ—Å—Ç–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞
- **–£–º–Ω—ã–π Fallback**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç mock wallet –µ—Å–ª–∏ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –Ω–µ—Ç
- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

## üéØ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –£–º–Ω—ã–π Fallback –º–µ—Ö–∞–Ω–∏–∑–º

1. **dApp –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∫–æ—à–µ–ª—å–∫–∞** (`window.tonkeeper?.instantPay`)
2. **–ï—Å–ª–∏ —Ä–µ–∞–ª—å–Ω—ã–π –∫–æ—à–µ–ª–µ–∫ –Ω–∞–π–¥–µ–Ω** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –µ–≥–æ
3. **–ï—Å–ª–∏ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∫–æ—à–µ–ª—å–∫–∞ –Ω–µ—Ç** - –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç mock wallet
4. **Mock wallet –∏–Ω–∂–µ–∫—Ç–∏—Ä—É–µ—Ç API** –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ fallback —Ä–µ–∂–∏–º–µ

### –ü–æ—Ç–æ–∫ —Å–æ–±—ã—Ç–∏–π

```mermaid
graph LR
    A[dApp –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è] --> B{–ï—Å—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π –∫–æ—à–µ–ª–µ–∫?}
    B -->|–î–∞| C[–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π]
    B -->|–ù–µ—Ç| D[–ó–∞–≥—Ä—É–∑–∏—Ç—å mock wallet]
    D --> E[Mock –∏–Ω–∂–µ–∫—Ç–∏—Ä—É–µ—Ç API]
    E --> F[dApp –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ]
    C --> F
    F --> G[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç –ø–ª–∞—Ç–µ–∂]
    G --> H[–ö–æ—à–µ–ª–µ–∫ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–Ω–æ–ø–∫—É]
    H --> I[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç]
    I --> J[–°–æ–±—ã—Ç–∏—è: click ‚Üí sent/cancelled]
```

## üß™ –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### –ë—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã
- ‚úÖ **–ë–∞–∑–æ–≤—ã–π TON –ø–ª–∞—Ç–µ–∂** - –ø—Ä–æ—Å—Ç–∞—è –æ–ø–ª–∞—Ç–∞ –≤ TON
- ‚úÖ **USDT –ø–ª–∞—Ç–µ–∂** - –æ–ø–ª–∞—Ç–∞ –≤ jetton —Ç–æ–∫–µ–Ω–µ  
- ‚úÖ **–¢–µ—Å—Ç –ª–∏–º–∏—Ç–æ–≤** - –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ —Å—É–º–º—ã
- ‚úÖ **–¢–µ—Å—Ç –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç–∏** - –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
- ‚úÖ `InstantPayInvalidParamsError` - –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- ‚úÖ `InstantPayLimitExceededError` - –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤
- ‚úÖ `InstantPayConcurrentOperationError` - –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ —Å—É–º–º—ã –∏ —Ç–æ–∫–µ–Ω—ã
- –†–∞–∑–ª–∏—á–Ω—ã–µ –º–µ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π (`buy`, `unlock`, `use`, etc.)
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ TON –∞–¥—Ä–µ—Å–∞–º–∏

## üéÆ –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### dApp Dashboard
- –°—Ç–∞—Ç—É—Å –∫–æ—à–µ–ª—å–∫–∞ (—Ä–µ–∞–ª—å–Ω—ã–π/mock)
- –¢–µ–∫—É—â–∞—è —Å–µ—Ç—å –∏ –ª–∏–º–∏—Ç—ã
- –ê–∫—Ç–∏–≤–Ω—ã–π invoice ID
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è API
- –õ–æ–≥–∏ —Å–æ–±—ã—Ç–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

### Mock Wallet Controls  
- –ê–∫—Ç–∏–≤–∞—Ü–∏—è/–¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –∫–æ—à–µ–ª—å–∫–∞
- –°–∏–º—É–ª—è—Ü–∏—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ API –≤—ã–∑–æ–≤–æ–≤
- –≠–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–æ–≤

## üìä API –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

### Wallet API (`window.tonkeeper.instantPay`)

```typescript
interface InstantPayAPI {
  config: InstantPayConfig;          // –ª–∏–º–∏—Ç—ã, —Å–µ—Ç—å, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ jettons
  setPayButton(params): void;        // –ø–æ–∫–∞–∑–∞—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É
  hidePayButton(): void;             // —Å–∫—Ä—ã—Ç—å –∫–Ω–æ–ø–∫—É
  events: InstantPayEmitter;         // —Å–æ–±—ã—Ç–∏—è click/sent/cancelled
}
```

### –°–æ–±—ã—Ç–∏—è
```typescript
type InstantPayEvent =
  | { type: 'click'; invoiceId: string }
  | { type: 'sent'; invoiceId: string; boc: string }
  | { type: 'cancelled'; invoiceId: string };
```

## üõ†Ô∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –ö–æ–º–∞–Ω–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
```bash
# –°–±–æ—Ä–∫–∞ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
npm run build

# –û—á–∏—Å—Ç–∫–∞ dist –ø–∞–ø–æ–∫
npm run clean

# –°–±–æ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–∞–∫–µ—Ç–∞
cd packages/types && npm run build
cd packages/mock-wallet && npm run build  
cd packages/dapp && npm run build
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ port–æ–≤
- **Mock Wallet**: http://localhost:3001
- **dApp**: http://localhost:3000
- **Cross-Origin**: –ù–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã –º–µ–∂–¥—É –ø–æ—Ä—Ç–∞–º–∏

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### Mock Wallet –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```typescript
config: {
  network: 'testnet',
  instantPayLimitTon: '10',
  jettons: [
    { symbol: 'USDT', address: 'EQ...', decimals: 6, instantPayLimit: '1000' },
    { symbol: 'USDC', address: 'EQ...', decimals: 6, instantPayLimit: '1000' }
  ],
  payLabels: ['buy', 'unlock', 'use', 'get', 'open', 'start', 'retry', 'show', 'play', 'try']
}
```

## üéØ –¶–µ–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω –¥–ª—è:
- ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏** InstantPay
- ‚úÖ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫—Ä–∞–π–Ω–∏—Ö —Å–ª—É—á–∞–µ–≤** –∏ —É—Å–ª–æ–≤–∏–π –æ—à–∏–±–æ–∫  
- ‚úÖ **–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏** –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- ‚úÖ **–û—Ü–µ–Ω–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ UX** –ø—Ä–æ—Ç–æ–∫–æ–ª–∞
- ‚úÖ **–û–±–∫–∞—Ç–∫–∏ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞** –±–µ–∑ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è

- Mock wallet **—Å–∏–º—É–ª–∏—Ä—É–µ—Ç** –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è, –Ω–æ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –Ω–∞—Å—Ç–æ—è—â–∏–µ –±–ª–æ–∫—á–µ–π–Ω —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- BOC –∑–Ω–∞—á–µ–Ω–∏—è –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —Å–ª—É—á–∞–π–Ω–æ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
- –°–µ—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: **testnet**
- –ü—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è **—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**, –Ω–µ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

## ü§ù –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ dev —Å–µ—Ä–≤–µ—Ä—ã**: `npm run dev`
2. **–û—Ç–∫—Ä–æ–π—Ç–µ dApp**: http://localhost:3000  
3. **–£–≤–∏–¥–∏—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ fallback** –Ω–∞ mock wallet
4. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏** —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å dApp
5. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ª–æ–≥–∏** –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
6. **–û—Ç–∫—Ä—ã–≤–∞–π—Ç–µ mock wallet –ø–∞–Ω–µ–ª—å**: http://localhost:3001 –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∫–æ–Ω—Ç—Ä–æ–ª–æ–≤

---

**–ü–æ—Å—Ç—Ä–æ–µ–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Tonkeeper InstantPay Protocol v1.0**