{
  "$id": "https://schemas.instantpay.dev/events.schema.json",
  "title": "InstantPayEvent",
  "description": "Union of events emitted by the wallet to the dApp during the InstantPay lifecycle.",
  "oneOf": [
    {
      "type": "object",
      "required": ["type","handshake"],
      "properties": {
        "type": { "const": "ready", "description": "Wallet is ready and provides handshake info." },
        "handshake": { "$ref": "handshake.schema.json", "description": "Handshake payload from the wallet." }
      },
      "additionalProperties": false
    },
    {
      "type": "object",
      "required": ["type","request"],
      "properties": {
        "type": { "const": "show", "description": "Payment UI became visible to the user." },
        "request": { "$ref": "payment-request.schema.json", "description": "Full payment request associated with the event." }
      },
      "additionalProperties": false
    },
    {
      "type": "object",
      "required": ["type","request"],
      "properties": {
        "type": { "const": "click", "description": "User clicked the Pay button." },
        "request": { "$ref": "payment-request.schema.json", "description": "Full payment request associated with the event." }
      },
      "additionalProperties": false
    },
    {
      "type": "object",
      "required": ["type","request","boc"],
      "properties": {
        "type": { "const": "sent", "description": "Payment was sent; BOC is provided." },
        "request": { "$ref": "payment-request.schema.json", "description": "Full payment request associated with the event." },
        "boc": { "type": "string", "description": "Bag of Cells (serialized transaction)." }
      },
      "additionalProperties": false
    },
    {
      "type": "object",
      "required": ["type","request"],
      "properties": {
        "type": { "const": "cancelled", "description": "Payment flow was cancelled." },
        "request": { "$ref": "payment-request.schema.json", "description": "Full payment request associated with the event." },
        "reason": { "type": "string", "enum": ["user","app","wallet","replaced","expired","unsupported_env"], "description": "Optional cancellation reason." }
      },
      "additionalProperties": false
    },
    {
      "type": "object",
      "required": ["type","request","url","scheme"],
      "properties": {
        "type": { "const": "handoff", "description": "Wallet hands off to an external scheme (deep link or web)." },
        "request": { "$ref": "payment-request.schema.json", "description": "Full payment request associated with the event." },
        "url": { "type": "string", "format": "uri", "description": "Target URL for the handoff." },
        "scheme": { "type": "string", "enum": ["ton","https"], "description": "Scheme used for the handoff." }
      },
      "additionalProperties": false
    }
  ]
}
